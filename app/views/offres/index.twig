<<<<<<< HEAD
{% extends "layout/base.twig" %}
{% block title %}Liste des Offres{% endblock %}
{% block content %}
<section class="content">
    <h2>Liste des Offres</h2>

    {% if user.role == 'Admin' or user.role == 'pilote' %}
        <!-- Formulaire de recherche pour l'admin -->
        <form class="search-form" method="GET" action="{{ url('wishlist', 'search') }}">
            <label for="etudiant_id">Rechercher la wishlist d'un étudiant :</label>
            <select id="etudiant_id" name="etudiant_id" required>
                <option value="">Sélectionnez un étudiant</option>
                {% if etudiants is defined and etudiants is not empty %}
                    {% for etudiant in etudiants %}
                        <option value="{{ etudiant.id }}" {% if etudiant_id is defined and etudiant_id == etudiant.id %}selected{% endif %}>
                            {{ etudiant.nom }} {{ etudiant.prenom }}
                        </option>
                    {% endfor %}
                {% else %}
                    <option value="" disabled>Aucun étudiant disponible</option>
                {% endif %}
            </select>
            <button type="submit" class="btn">Rechercher</button>
        </form>
    {% endif %}

    <!-- Formulaire de recherche -->
<<<<<<< Updated upstream
    <form class="search-form" method="GET" action="{{ BASE_URL }}index.php">
        <input type="hidden" name="controller" value="offre">
        <input type="hidden" name="action" value="search">
=======
    <form class="search-form" method="GET" action="{{ url('offre', 'search') }}">
        <input type="hidden" name="notif" value="1">
>>>>>>> Stashed changes
        <label for="motcle">Mot-clé :</label>
        <input type="text" id="motcle" name="motcle" value="{{ motcle is defined ? motcle|e : '' }}" required>
        <button type="submit" class="btn">Rechercher</button>
    </form>

    <div class="offers-container">
        {% if offres is not empty %}
            {% for offre in offres %}
                <div class="offer-card">
                    <h4>{{ offre.titre|e }} - {{ offre.entreprise|e }}</h4>
                    <p><strong>Rémunération :</strong> {{ offre.remuneration|e }}€</p>
                    <p>{{ offre.description is defined ? offre.description|e : '' }}</p>
                    
                    <div class="offer-buttons">
<<<<<<< Updated upstream
                        <a href="{{ BASE_URL }}index.php?controller=offre&action=detail&id={{ offre.id }}" class="btn-voir">Voir</a>
                        {% if user is defined and user.role == 'Étudiant' %}
                            <form action="{{ BASE_URL }}index.php?controller=wishlist&action=add" method="POST" style="display:inline;">
                                <input type="hidden" name="offre_id" value="{{ offre.id }}">
                                <button type="submit" class="btn">Ajouter à la Wishlist</button>
                            </form>
=======
                        <a href="{{ url('offre', 'detail', {'id': offre.id}) }}" class="btn-voir">Voir</a>
                        {% if user.role == 'Étudiant' %}
                            <button type="button" class="btn-add-wishlist" data-offre-id="{{ offre.id }}" data-offre-title="{{ offre.titre }}">Ajouter à la wishlist</button>
>>>>>>> Stashed changes
                        {% endif %}
                    </div>
                </div>
            {% endfor %}
        {% else %}
            <p style="text-align: center; color: #777;">Aucune offre trouvée.</p>
        {% endif %}
    </div>

    <!-- Pagination -->
    {% if totalPages is defined and totalPages > 0 %}
        <div class="pagination">
            {% if page > 1 %}
                <a href="{{ url('offre', motcle is not empty ? 'search' : 'index', {'page': page - 1, 'motcle': motcle, 'competences': competences}) }}">Précédent</a>
            {% endif %}

            {% set window = 3 %}
            {% if totalPages <= window %}
                {% set start = 1 %}
                {% set end = totalPages %}
            {% else %}
                {% set start = page - 1 %}
                {% if start < 1 %}
                    {% set start = 1 %}
                {% endif %}
                {% set end = start + window - 1 %}
                {% if end > totalPages %}
                    {% set end = totalPages %}
                    {% set start = end - window + 1 %}
                    {% if start < 1 %}
                        {% set start = 1 %}
                    {% endif %}
                {% endif %}
            {% endif %}

            {% for i in start..end %}
                <a href="{{ url('offre', motcle is not empty ? 'search' : 'index', {'page': i, 'motcle': motcle, 'competences': competences}) }}" class="{% if i == page %}active{% endif %}">{{ i }}</a>
            {% endfor %}

            {% if page < totalPages %}
                <a href="{{ url('offre', motcle is not empty ? 'search' : 'index', {'page': page + 1, 'motcle': motcle, 'competences': competences}) }}">Suivant</a>
            {% endif %}
        </div>
    {% endif %}
</section>
<<<<<<< Updated upstream
=======

<script>
  const BASE_URL = "{{ BASE_URL }}";
</script>

<script src="{{ BASE_URL }}public/js/offres.js"></script>
<script src="{{ BASE_URL }}public/js/wishlist.js"></script>

>>>>>>> Stashed changes
{% endblock %}
=======
{% extends "layout/base.twig" %}
{% block title %}Liste des Offres{% endblock %}
{% block content %}
<section class="content">
    <h2>Liste des Offres</h2>

    {% if user.role == 'Admin' or user.role == 'pilote' %}
        <!-- Formulaire de recherche pour l'admin -->
        <form class="search-form" method="GET" action="{{ url('wishlist', 'search') }}">
            <label for="etudiant_id">Rechercher la wishlist d'un étudiant :</label>
            <select id="etudiant_id" name="etudiant_id" required>
                <option value="">Sélectionnez un étudiant</option>
                {% if etudiants is defined and etudiants is not empty %}
                    {% for etudiant in etudiants %}
                        <option value="{{ etudiant.id }}" {% if etudiant_id is defined and etudiant_id == etudiant.id %}selected{% endif %}>
                            {{ etudiant.nom }} {{ etudiant.prenom }}
                        </option>
                    {% endfor %}
                {% else %}
                    <option value="" disabled>Aucun étudiant disponible</option>
                {% endif %}
            </select>
            <button type="submit" class="btn">Rechercher</button>
        </form>
    {% endif %}

    <!-- Formulaire de recherche -->
<<<<<<< Updated upstream
    <form class="search-form" method="GET" action="{{ BASE_URL }}index.php">
        <input type="hidden" name="controller" value="offre">
        <input type="hidden" name="action" value="search">
=======
    <form class="search-form" method="GET" action="{{ url('offre', 'search') }}">
        <input type="hidden" name="notif" value="1">
>>>>>>> Stashed changes
        <label for="motcle">Mot-clé :</label>
        <input type="text" id="motcle" name="motcle" value="{{ motcle is defined ? motcle|e : '' }}" required>
        <button type="submit" class="btn">Rechercher</button>
    </form>

    <div class="offers-container">
        {% if offres is not empty %}
            {% for offre in offres %}
                <div class="offer-card">
                    <h4>{{ offre.titre|e }} - {{ offre.entreprise|e }}</h4>
                    <p><strong>Rémunération :</strong> {{ offre.remuneration|e }}€</p>
                    <p>{{ offre.description is defined ? offre.description|e : '' }}</p>
                    
                    <div class="offer-buttons">
<<<<<<< Updated upstream
                        <a href="{{ BASE_URL }}index.php?controller=offre&action=detail&id={{ offre.id }}" class="btn-voir">Voir</a>
                        {% if user is defined and user.role == 'Étudiant' %}
                            <form action="{{ BASE_URL }}index.php?controller=wishlist&action=add" method="POST" style="display:inline;">
                                <input type="hidden" name="offre_id" value="{{ offre.id }}">
                                <button type="submit" class="btn">Ajouter à la Wishlist</button>
                            </form>
=======
                        <a href="{{ url('offre', 'detail', {'id': offre.id}) }}" class="btn-voir">Voir</a>
                        {% if user.role == 'Étudiant' %}
                            <button type="button" class="btn-add-wishlist" data-offre-id="{{ offre.id }}" data-offre-title="{{ offre.titre }}">Ajouter à la wishlist</button>
>>>>>>> Stashed changes
                        {% endif %}
                    </div>
                </div>
            {% endfor %}
        {% else %}
            <p style="text-align: center; color: #777;">Aucune offre trouvée.</p>
        {% endif %}
    </div>

    <!-- Pagination -->
    {% if totalPages is defined and totalPages > 0 %}
        <div class="pagination">
            {% if page > 1 %}
                <a href="{{ url('offre', motcle is not empty ? 'search' : 'index', {'page': page - 1, 'motcle': motcle, 'competences': competences}) }}">Précédent</a>
            {% endif %}

            {% set window = 3 %}
            {% if totalPages <= window %}
                {% set start = 1 %}
                {% set end = totalPages %}
            {% else %}
                {% set start = page - 1 %}
                {% if start < 1 %}
                    {% set start = 1 %}
                {% endif %}
                {% set end = start + window - 1 %}
                {% if end > totalPages %}
                    {% set end = totalPages %}
                    {% set start = end - window + 1 %}
                    {% if start < 1 %}
                        {% set start = 1 %}
                    {% endif %}
                {% endif %}
            {% endif %}

            {% for i in start..end %}
                <a href="{{ url('offre', motcle is not empty ? 'search' : 'index', {'page': i, 'motcle': motcle, 'competences': competences}) }}" class="{% if i == page %}active{% endif %}">{{ i }}</a>
            {% endfor %}

            {% if page < totalPages %}
                <a href="{{ url('offre', motcle is not empty ? 'search' : 'index', {'page': page + 1, 'motcle': motcle, 'competences': competences}) }}">Suivant</a>
            {% endif %}
        </div>
    {% endif %}
</section>
<<<<<<< Updated upstream
=======

<script>
  const BASE_URL = "{{ BASE_URL }}";
</script>

<script src="{{ BASE_URL }}public/js/offres.js"></script>
<script src="{{ BASE_URL }}public/js/wishlist.js"></script>

>>>>>>> Stashed changes
{% endblock %}
>>>>>>> b170562517c999ebafcfe1964b36d4502144dd48

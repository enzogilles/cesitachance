{% extends "layout/base.twig" %}
{% block title %}D√©tail de l'Offre{% endblock %}
{% block content %}
<section class="content">
    <h2>D√©tail de l'offre</h2>
    {% set userRole = user.role|default(null) %}
    <h3>
        {{ offre.titre is defined ? offre.titre|e : 'Titre indisponible' }} - 
        {{ offre.entreprise is defined ? offre.entreprise|e : 'Entreprise inconnue' }}
    </h3>
    <p><strong>R√©mun√©ration :</strong> {{ offre.remuneration is defined ? offre.remuneration|e ~ '‚Ç¨' : 'Non pr√©cis√©e' }}</p>
    <p><strong>Date de d√©but :</strong> {{ offre.date_debut is defined ? offre.date_debut|e : 'Non pr√©cis√©e' }}</p>
    <p><strong>Date de fin :</strong> {{ offre.date_fin is defined ? offre.date_fin|e : 'Non pr√©cis√©e' }}</p>
    <p><strong>Description :</strong> {{ offre.description is defined ? offre.description|e|nl2br : 'Aucune description' }}</p>
    <div class="offer-buttons">
        {% if userRole == '√âtudiant' %}
<<<<<<< Updated upstream
            <form action="{{ BASE_URL }}index.php?controller=wishlist&action=add" method="POST" style="display:inline;">
                <input type="hidden" name="offre_id" value="{{ offre.id }}">
                <button type="submit" class="btn btn-wishlist">‚ù§Ô∏è Ajouter √† la Wishlist</button>
            </form>
        {% endif %}
    </div>
    {% if userRole == '√âtudiant' %}
        <h3>Postuler √† cette offre</h3>
        <form action="{{ BASE_URL }}index.php?controller=candidature&action=postuler" method="post" enctype="multipart/form-data">
            <input type="hidden" name="offre_id" value="{{ offre.id }}">
            <label for="cv">CV (PDF uniquement) :</label>
            <input type="file" id="cv" name="cv" accept="application/pdf" required>
            <label for="lettre_motivation">Lettre de motivation :</label>
            <textarea id="lettre_motivation" name="lettre_motivation" required></textarea>
            <button type="submit" class="btn">üì© Postuler</button>
        </form>
=======
            <button type="button" class="btn-wishlist" data-offre-id="{{ offre.id }}">Ajouter √† la Wishlist</button>
        {% endif %}
    </div>
    {% if userRole == '√âtudiant' %}
      <h3>Postuler √† cette offre</h3>
      <form id="postuler-form" action="{{ url('candidature', 'postuler') }}" method="post" enctype="multipart/form-data">
        <input type="hidden" name="offre_id" value="{{ offre.id }}">

        <label for="cv">CV (PDF uniquement) :</label>
        <div class="cv-upload" id="cv-upload-label"> 
            Ajouter mon CV
            <input type="file" id="cv" name="cv" accept=".pdf" required> 
        </div>         
        <div class="cv-label-container">
            <p id="cv-label" class="cv-label"></p>
            <button type="button" class="cv-btn" id="remove-cv">Retirer le CV</button>
        </div>

        <label for="lettre_motivation">Lettre de motivation :</label>
        <textarea id="lettre_motivation" name="lettre_motivation" required></textarea>

        <button type="submit" class="btn">Postuler</button>
        <button type="reset" class="bouton-reset reset-btn">R√©initialiser</button>
      </form>

    <script>
      document.getElementById('cv').addEventListener('change', function() {
        const removeButton = document.getElementById('remove-cv');
        const fileNameLabel = document.getElementById('cv-label');
        if (this.files.length > 0) {
          fileNameLabel.textContent = this.files[0].name;
          removeButton.style.display = 'inline-block';
        } else {
          fileNameLabel.textContent = '';
          removeButton.style.display = 'none';
        }
      });

      document.getElementById('remove-cv').addEventListener('click', function() {
        const cvInput = document.getElementById('cv');
        const fileNameLabel = document.getElementById('cv-label');
        cvInput.value = '';
        fileNameLabel.textContent = '';
        this.style.display = 'none';
      });

      document.querySelector('.reset-btn').addEventListener('click', function() {
        const cvInput = document.getElementById('cv');
        const fileNameLabel = document.getElementById('cv-label');
        const removeButton = document.getElementById('remove-cv');
        cvInput.value = '';
        fileNameLabel.textContent = '';
        removeButton.style.display = 'none';
      });
    </script>
    {% elseif userRole is null %}
      <p>Connectez-vous pour postuler</p>
>>>>>>> Stashed changes
    {% else %}
        <p>Seuls les √©tudiants peuvent postuler √† une offre.</p>
    {% endif %}
    <div class="back-button-container">
        <a href="{{ url('offre', 'index') }}" class="btn btn-back">‚¨Ö Retour aux offres</a>
    </div>
</section>
{% endblock %}

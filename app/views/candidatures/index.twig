{% extends "layout/base.twig" %}
{% block title %}Vos Candidatures{% endblock %}
{% block content %}
<section class="content">
    {% if userRole in ['Admin', 'pilote'] %}
        <h3>Candidatures des Étudiants</h3>
    {% elseif userRole == 'etudiant' %}
        <h3>Mes Candidatures</h3>
    {% endif %}
    <table class="styled-table">
        <thead>
            <tr>
                <th>Entreprise</th>
                <th>Offre</th>
                <th>Élève</th>
                <th>Date</th>
                <th>CV</th>
                <th>Statut</th>
            </tr>
        </thead>
        <tbody>
            {% if candidatures is not empty %}
                {% for candidature in candidatures %}
                    {% if candidature.statut == 1 %}
                        {% set statut_class = 'accepted' %}
                        {% set statut_label = 'Acceptée' %}
                    {% elseif candidature.statut == 2 %}
                        {% set statut_class = 'refused' %}
                        {% set statut_label = 'Refusée' %}
                    {% else %}
                        {% set statut_class = 'pending' %}
                        {% set statut_label = 'En attente' %}
                    {% endif %}
                    <tr data-id="{{ candidature.id }}">
                        <td>{{ candidature.entreprise|e }}</td>
                        <td>{{ candidature.titre|e }}</td>
                        <td>{{ candidature.user_nom ~ ' ' ~ candidature.user_prenom }}</td>
                        <td>{{ candidature.date_soumission|e }}</td>
                        <td>
                            {% if candidature.cv is defined and candidature.cv != '' %}
                                <a href="{{ BASE_URL }}{{ candidature.cv }}" target="_blank" class="cv-link">
                                    {% if userRole == 'etudiant' %}
                                        Voir mon CV
                                    {% else %}
                                        Voir le CV
                                    {% endif %}
                                </a>
                            {% else %}
                                Non fourni
                            {% endif %}
                        </td>
                        <td class="status {{ statut_class }}">
                            {{ statut_label }}
                        </td>
                    </tr>
                {% endfor %}
            {% else %}
                <tr>
                    <td colspan="6" style="text-align:center;">Aucune candidature en cours</td>
                </tr>
            {% endif %}
        </tbody>
    </table>
    {% if userRole in ['Admin', 'pilote'] %}
        <p>Cliquez sur le statut pour modifier l'état de la candidature.</p>
    {% endif %}
</section>

<script>
  const BASE_URL = "{{ BASE_URL }}";
</script>

{% if userRole == 'Admin' %}
    <script src="{{ BASE_URL }}public/js/candidatures.js"></script>
{% endif %}
{% endblock %}
